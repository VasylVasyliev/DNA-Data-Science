import numpy as np

def generate_fcc_cluster(element, lattice_constant, size):
    """
    English: Generates a Face-Centered Cubic (FCC) lattice for a metal nanoparticle.
    Russian: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≥—Ä–∞–Ω–µ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫—É–±–∏—á–µ—Å–∫—É—é —Ä–µ—à–µ—Ç–∫—É (–ì–¶–ö) –¥–ª—è –Ω–∞–Ω–æ—á–∞—Å—Ç–∏—Ü—ã –º–µ—Ç–∞–ª–ª–∞.
    """
    atoms = []
    r = size  # Radius in lattice units / –†–∞–¥–∏—É—Å –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö —Ä–µ—à–µ—Ç–∫–∏
    
    # Grid search for atoms inside the sphere
    # –ü–µ—Ä–µ–±–æ—Ä —Ç–æ—á–µ–∫ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞—Ç–æ–º–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Å—Ñ–µ—Ä—ã
    for x in range(-r, r+1):
        for y in range(-r, r+1):
            for z in range(-r, r+1):
                # Check FCC condition (x, y, z must have same parity)
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –ì–¶–ö (—Å—É–º–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–µ—Ç–Ω–æ–π –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —è—á–µ–π–∫–∏)
                if (x + y + z) % 2 == 0:
                    # Calculate distance from center / –°—á–∏—Ç–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
                    dist = np.sqrt(x**2 + y**2 + z**2)
                    if dist <= r:
                        # Scale coordinates by lattice constant
                        # –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é —Ä–µ—à–µ—Ç–∫–∏ (–¥–ª—è –°–µ—Ä–µ–±—Ä–∞ ~4.09 A)
                        # We use 0.5 factor because integer steps correspond to half-cells
                        px = x * lattice_constant / 2.0
                        py = y * lattice_constant / 2.0
                        pz = z * lattice_constant / 2.0
                        atoms.append((element, px, py, pz))
    
    return atoms

def save_xyz(filename, atoms):
    with open(filename, "w") as f:
        f.write(f"{len(atoms)}\n")
        f.write("Generated by HeLa_Project_2026\n")
        for atom in atoms:
            f.write(f"{atom[0]} {atom[1]:.3f} {atom[2]:.3f} {atom[3]:.3f}\n")

if __name__ == "__main__":
    # Silver (Ag) parameters:
    # Lattice constant: 4.09 Angstroms
    # Size: ~2-3 nm radius
    print("üöÄ Starting Silver (Ag) Nanoparticle Generation...")
    
    ag_atoms = generate_fcc_cluster("Ag", 4.09, 6)
    
    output_file = "../data/nanomaterials/Ag_2026_model.xyz"
    
    # Ensure folder exists / –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –µ—Å–ª–∏ –Ω–µ—Ç
    import os
    os.makedirs("../data/nanomaterials", exist_ok=True)
    
    save_xyz(output_file, ag_atoms)
    
    print(f"‚úÖ Created Silver cluster with {len(ag_atoms)} atoms.")
    print(f"üìÅ File saved to: {output_file}")